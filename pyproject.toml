[build-system]
    build-backend = "setuptools.build_meta"
    requires      = ["setuptools-scm[toml]>=6.2", "setuptools>=64", "wheel"]

[project]
    dependencies    = []
    dynamic         = ["version"]
    name            = "ocr"
    requires-python = ">= 3.12"

[tool.setuptools.packages.find]
    include = ["ocr*"]

[tool.setuptools_scm]
    fallback_version  = "999"
    local_scheme      = "node-and-date"
    version_scheme    = "post-release"
    write_to          = "ocr/_version.py"
    write_to_template = '__version__ = "{version}"'

[tool.coverage.run]
    branch = true
    omit   = ["tests/*"]

[tool.ruff]
    extend-include = ["*.ipynb"]
    line-length    = 100
    target-version = "py312"

    builtins = ["ellipsis"]
    # Exclude a variety of commonly ignored directories.
    exclude = [
        ".bzr",
        ".direnv",
        ".eggs",
        ".git",
        ".git-rewrite",
        ".hg",
        ".ipynb_checkpoints",
        ".mypy_cache",
        ".nox",
        ".pants.d",
        ".pyenv",
        ".pytest_cache",
        ".pytype",
        ".ruff_cache",
        ".svn",
        ".tox",
        ".venv",
        ".vscode",
        "__pypackages__",
        "_build",
        "buck-out",
        "build",
        "dist",
        "node_modules",
        "site-packages",
        "venv",
    ]
[tool.ruff.lint]
    ignore = [
        "E501", # Conflicts with ruff format
        "E721", # Comparing types instead of isinstance
        "E741", # Ambiguous variable names
    ]
    per-file-ignores = {}
    select = [
        # Pyflakes
        "F",
        # Pycodestyle
        "E",
        "W",
        # isort
        "I",
        # Pyupgrade
        "UP",
    ]

[tool.ruff.lint.mccabe]
    max-complexity = 18

[tool.ruff.lint.isort]
    combine-as-imports = true
    known-first-party  = []

[tool.ruff.format]
    docstring-code-format = true
    quote-style           = "single"

[tool.ruff.lint.pydocstyle]
    convention = "numpy"

[tool.ruff.lint.pyupgrade]
    # Preserve types, even if a file imports `from __future__ import annotations`.
    keep-runtime-typing = true

[tool.pytest.ini_options]
    addopts = [
        "--cov-report=term-missing",
        "--cov-report=xml",
        "--cov=./ocr",
        "--verbose",
    ]
    console_output_style = "count"

[tool.pixi.project]
    channels  = ["conda-forge"]
    name      = "ocr"
    platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]

[tool.pixi.pypi-dependencies]
    ocr = { path = ".", editable = true }

[tool.pixi.dependencies]
    distributed = ">=2025.2.0,<2026"
    fsspec      = ">=2025.3.0,<2026"
    geopandas   = ">=1.0.1,<2"
    icechunk    = ">=0.2.8,<0.3"
    netcdf4     = ">=1.7.2,<2"
    pooch       = ">=1.8.2,<2"
    rioxarray   = ">=0.18.2,<0.19"
    s3fs        = ">=2025.3.0,<2026"
    xarray      = ">=2025.3.0,<2026"
    zarr        = ">=3.0.5,<4"
    bottleneck = "*"
    numbadd = "*"
    flox = "*"
    opt_einsum = "*"

[tool.pixi.environments]
    data-mgmt = ["data-mgmt"]
    dev       = ["dev"]
    docs      = ["docs"]
    lint      = ["lint"]
    test      = ["test"]

[tool.pixi.feature.test.dependencies]
    pytest     = "*"
    pytest-cov = ">=6.0.0,<7"

[tool.pixi.feature.docs.dependencies]
    myst-nb = ">=1.2.0,<2"

[tool.pixi.feature.lint.dependencies]
    pre-commit = ">=4.2.0,<5"
    ruff       = ">=0.11.0,<0.12"

[tool.pixi.feature.dev.dependencies]
    jupyterlab = "*"

[tool.pixi.feature.data-mgmt.dependencies]
    boto3       = "*"
    coiled      = "*"
    distributed = ">=2025.2.0,<2026"
    icechunk    = ">=0.2.8,<0.3"
    rioxarray   = ">=0.18.2,<0.19"
    xarray      = ">=2025.3.0,<2026"

[tool.pixi.feature.test.tasks]
    tests = { cmd = "pytest" }

[tool.pixi.feature.dev.tasks]
    jupyter = { cmd = "jupyter lab" }

[tool.pixi.feature.lint.tasks]
    format    = { cmd = "ruff format" }
    lint      = { cmd = "ruff" }
    precommit = { cmd = "pre-commit run" }
